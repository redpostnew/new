
# 나눔/묶음 배송

## 현재
- 구매대행 - 견적이후부터  고객이 주문서  수정, 묶음/나눔 불가 
- 배송대행 - 입고이후부터  고객이 주문서  수정, 묶음/나눔 불가
- 검수완료 후 쿠팡고객
  - 상품a  10개   + c 10개   한개센터
  - a 5개 + b 10개   한개센터 
- 관리자는 무제한 나눔/묶음 가능함
## New 원칙
- ✅ 원본 주문번호는 절대 변경되지 않음  
- ✅ 고객은 원래 주문번호로 조회 가능  
- ✅ 배송은 유연하게 그룹핑 가능  

## 출고관리 화면
### 1. 입고완료 상품 목록
#### 개요
- 고객별로 검수완료된 상품들을 표시  
- 원본 주문번호별로 그룹핑해서 보여줌  

#### 원주문번호
  - 원주문번호는 그대로 유지
  - 고객이 결제한 주문번호는 절대 바꾸지 않음.
  - 예: 20251017001234
  - 주문번호 체계는 추후 알려드릴게요.
  - 고객 화면과 정산 등에 필요함

### 2. 나눔/묶음 시작 (예시)
#### 나눔배송 (분할배송)
- 개요
  - 한 주문에 여러 품목이 있을 때, 품목별로 나눠서 배송
  - 하위주문번호를 만들어 구분
  - 원주문번호 + -01, -02 등으로 구별
  - 각 하위 주문마다 별도 송장번호 사용 가능
- 예시
  - 원주문: 20251017001234 (상품 A, B, C)
  - 출고1: 
    - sub_order_no: 20251017001234-01
    - 상품: A
    - 송장: CJ123456789
  - 출고2:
    - sub_order_no: 20251017001234-02  
    - 상품: B, C
    - 송장: HJ987654321
#### 묶음배송 (합배송)
- 개요
  - 여러 주문을 한 번에 합쳐서 배송
  - **묶음번호(bd_no)**를 생성 → 여러 주문 연결
  - 묶음번호 기준으로 하나의 송장번호 사용
- 예시
  - 원주문1: 20251017001234 (상품 A)
  - 원주문2: 20251017001235 (상품 B)
  - 묶음출고:
    - bundle_no: BD-20251017-0001
    - 상품: A + B
    - 송장: CJ123456791 (하나)

### 3.  배송 현황
- 하나의 주문 상품을 여러 배송으로 나눌 수 있음  
- 여러 주문의 상품을 하나의 배송으로 합칠 수 있음  
- 배송 그룹별 진행상황 추적  
- 원본 주문번호와의 연결관계 유지  

## 배송 변경 관리 가이드
### 제한이 없을 때 생기는 문제
#### 1. 비용 증가
    -   직원이 하루 종일 변경 요청 처리만 함
    -   포장 다시 해야 해서 인건비와 자재 낭비
    -   배송 지연으로 고객 불만과 환불 발생
#### 2. 운영 혼란
    -   시스템 데이터가 꼬여서 관리 어려움
    -   관리포인트가 더 늘어남

###  해결책: 단계별 제한
#### 1. 시점 제한

| 단계 | 내용 | 처리 정책 |
|------|------|------------|
| 검수 완료 후 24시간 이내 | 고객이 무료로 변경 가능 | 무료 |
| 포장 시작 이후 | 변경은 가능하지만 수수료 발생 | 2,000~5,000원 |
| 출고 완료 이후 | 변경 불가 | ❌ 불가능 |

#### 2. 횟수 제한
    -   주문 1건당 최대 변경 2회까지만 허용
    -   한 달에 5회 초과 시 자동 제한 조치
#### 3. 수수료 기준
| 변경 상황 | 수수료 |
|------------|---------|
| 1회 변경 | 무료 |
| 2회 변경 | 2,000원 |
| 포장 후 변경 | 5,000원 |
| 긴급 변경 (출고 직전) | 10,000원 |


## 나눔배송+묶음배송 처리 순서 가이드

### 원칙: 항상 **나눔 → 묶음** 순서로 진행
#### 1. 나눔(분할) 먼저
- 원주문을 출고 단위로 쪼개서 정리  
- 하위주문번호(`-01`, `-02` 등) 생성  
- 각 출고 단위는 독립된 배송 그룹으로 관리  
- 예시:
    - 원주문: 20251017001234
    - └─ 하위주문
    - ├─ 20251017001234-01 (상품 A)
    - └─ 20251017001234-02 (상품 B, C)

#### 2. 묶음(합배송) 나중
- 여러 하위주문 또는 다른 주문을 하나로 묶음  
- 묶음번호(`bundle_no`) 생성 (예: BD-20251017-0001)  
- 묶음 내의 각 하위주문은 개별 추적 가능하지만, 송장은 하나  
- 예시:
  - 묶음배송: BD-20251017-0001
  - └─ 포함:
  - ├─ 20251017001234-01 (상품 A)
  - └─ 20251017001235-02 (상품 B)

### 묶음 → 나눔 순서는 피해야 하는 이유
- 묶은 후 다시 나누면 번호 체계가 꼬임  
- 송장, 배송비, 재고, 정산 전부 혼선  
- “합쳤다가 쪼갠 상품”의 원소속 판단이 불가능  

### 단계별 프로세스 요약

| 단계 | 작업 | 설명 | 상태 |
|------|------|------|------|
| 1단계 | 검수 완료 | 출고 가능 상태 | 준비 완료 |
| 2단계 | 나눔배송 | 하위주문번호 생성 | 분할 확정 |
| 3단계 | 묶음배송 | 여러 하위주문을 묶음번호로 합침 | 출고 준비 |
| 4단계 | 출고 | 송장번호 부여 및 배송비 정산 | ✅ 완료 |

### 나눔->묶믐->다른주문서랑 다시 묶을 때
#### 고객에게는 기능이 없음
- 묶음처리 시 자동으로 출고 준비 단계로 넘어가기 때문
- 나눔된 주문이 이미 재고 배정 및 패킹 상태에 들어가 있어, 재조정 시 오류 위험이 큼
- 일부 시스템은 묶음 상태를 고정하여 다른 주문과 재조합을 막음

#### 예외적으로 가능한 경우(관리자가 수정)
- 다음 조건을 만족하면 고객센터나 관리자 요청을 통해 재묶음이 가능할 수 있습니다.
- 아직 “출고대기” 상태이며 운송장이 생성되지 않은 경우
- 두 주문 모두 같은 창고·같은 수취인 정보를 가지고 있을 때
- 플랫폼에서 “묶음 해제” 기능을 지원할 때

| 상황             | 가능 여부            | 비고 |
| -------------- | ---------------- | -- |
| 출고대기 / 운송장 미생성 | ⭕ 가능 (관리자 요청 필요) |    |
| 이미 포장 완료       | ❌ 불가능            |    |
| 묶음해제 기능 제공 시   | ⭕ 가능             |    |

###  결론
- 반드시 **나눔 → 묶음 순서**를 유지해야 함  
- “묶음 후 재분할”은 금지 또는 관리자 승인 필요  
- 묶음번호 생성은 **최종 출고 직전 단계**에서만 허용  
- 이 원칙을 지키면 복잡한 배송 구조에서도 데이터 일관성과 추적성이 유지
- 제한이 없으면 운영이 마비되고 비용이 급증
- 명확한 **시점·횟수·수수료 제한**이 고객 만족과 회사 안정성을 모두 지키는 핵심

## 참조화면
<img src="https://i.ibb.co/ZpYs96sn/Snipaste-2025-11-13-10-06-29.png" border="0">
<img src="https://i.ibb.co/Y4kXrSm7/Snipaste-2025-11-13-10-06-40.png" border="0">
<img src="https://i.ibb.co/d4dJWHFC/Snipaste-2025-11-13-10-06-55.png" border="0">
